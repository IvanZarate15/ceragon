{% extends "base.html" %}
{% block content %}
<h2>Links</h2>
<table id="linksTbl">
  <thead>
    <tr>
      <th>Sites</th><th>Freq (GHz)</th><th>Cap (Mbps)</th><th>Long (km)</th><th>Vendor</th><th>Status</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3>Crear Link</h3>
<form id="createLink">
  <input id="site_a" placeholder="site-a-slug" required />
  <input id="site_b" placeholder="site-b-slug" required />
  <input id="freq" type="number" step="0.01" placeholder="frecuencia GHz" required />
  <input id="cap" type="number" placeholder="capacidad Mbps" required />
  <select id="vendor"><option>CERAGON</option><option>OTHER</option></select>
  <button type="submit">Crear</button>
</form>

<script>
  function auth() { return { "Authorization": "Bearer " + localStorage.getItem("access") }; }

  function loadLinks() {
    $.ajax({ url: "/api/links/?ordering=-created_at", headers: auth() })
    .done(function (data) {
      const rows = data.map(l => `<tr>
        <td>${l.site_a} â†” ${l.site_b}</td>
        <td>${l.frequency_ghz}</td>
        <td>${l.capacity_mbps}</td>
        <td>${l.km_length}</td>
        <td>${l.vendor}</td>
        <td>${l.status}</td></tr>`);
      $("#linksTbl tbody").html(rows.join(""));
    })
    .fail(xhr => alert(JSON.stringify(xhr.responseJSON)));
  }

  $("#createLink").on("submit", function(e){
    e.preventDefault();
    $.ajax({
      url: "/api/links/", method: "POST", headers: auth(),
      contentType: "application/json",
      data: JSON.stringify({
        site_a: $("#site_a").val(), site_b: $("#site_b").val(),
        frequency_ghz: $("#freq").val(), capacity_mbps: $("#cap").val(),
        vendor: $("#vendor").val(), status: "ACTIVE"
      })
    }).done(() => { loadLinks(); this.reset(); })
      .fail(xhr => alert(JSON.stringify(xhr.responseJSON)));
  });

  $(document).ready(loadLinks);
</script>
{% endblock %}
